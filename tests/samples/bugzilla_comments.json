{"comments":{},"bugs":{"275381":{"comments":[{"is_private":false,"time":"2023-11-27T17:14:39Z","text":"This is originally reported by khng@ on Telegram bsd dev group. Post it here to make it public.\n\nSteps to repeat:\n\nBoot with Ethernet interface disabled, then try to enable it.\n\n```\n> set hint.hn.0.disabled=\"1\"\n> boot\n...\n# devctl enable hn0\n```\n\n\nPart of core text dump:\n\nfreebsd dumped core - see /var/crash/vmcore.0\n\nMon Nov 20 04:17:24 UTC 2023\n\nFreeBSD freebsd 14.0-RELEASE FreeBSD 14.0-RELEASE #0 releng/14.0-n265380-f9716eee8ab4: Fri Nov 10 05:57:23 UTC 2023     root@releng1.nyi.freebsd.org:/usr/obj/usr/src/amd64.amd64/sys/GENERIC  amd64\n\npanic: page fault\n\nGNU gdb (GDB) 13.2 [GDB v13.2 for FreeBSD]\nCopyright (C) 2023 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\nType \"show copying\" and \"show warranty\" for details.\nThis GDB was configured as \"x86_64-portbld-freebsd14.0\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<https://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n    <http://www.gnu.org/software/gdb/documentation/>.\n\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from /boot/kernel/kernel...\nReading symbols from /usr/lib/debug//boot/kernel/kernel.debug...\n\nUnread portion of the kernel message buffer:\n\n\nFatal trap 12: page fault while in kernel mode\ncpuid = 1; apic id = 01\nfault virtual address\t= 0x28\nfault code\t\t= supervisor read data, page not present\ninstruction pointer\t= 0x20:0xffffffff80c5e0c8\nstack pointer\t        = 0x28:0xfffffe0053f4b900\nframe pointer\t        = 0x28:0xfffffe0053f4b940\ncode segment\t\t= base 0x0, limit 0xfffff, type 0x1b\n\t\t\t= DPL 0, pres 1, long 1, def32 0, gran 1\nprocessor eflags\t= interrupt enabled, resume, IOPL = 0\ncurrent process\t\t= 650 (devctl)\nrdi: fffff80006eb6800 rsi: fffff80001027500 rdx: 0000000000000001\nrcx: 0000000000000001  r8: 0000000000000000  r9: 8080808080808080\nrax: 0000000000000000 rbx: fffffe0054963c80 rbp: fffffe0053f4b940\nr10: ffffffff811e1f39 r11: 8b9091ff93939e00 r12: fffff80007fca000\nr13: fffff80007305c20 r14: ffffffff811e1f39 r15: 0000000000000000\ntrap number\t\t= 12\npanic: page fault\ncpuid = 1\ntime = 1700453806\nKDB: stack backtrace:\n#0 0xffffffff80b9002d at kdb_backtrace+0x5d\n#1 0xffffffff80b43132 at vpanic+0x132\n#2 0xffffffff80b42ff3 at panic+0x43\n#3 0xffffffff8100c85c at trap_fatal+0x40c\n#4 0xffffffff8100c8af at trap_pfault+0x4f\n#5 0xffffffff80fe3828 at calltrap+0x8\n#6 0xffffffff80c5ceb5 at if_attach_internal+0x55\n#7 0xffffffff80c6824c at ether_ifattach+0x2c\n#8 0xffffffff80f779c6 at hn_attach+0x21d6\n#9 0xffffffff80b7fa1e at device_attach+0x3be\n#10 0xffffffff80b84dcf at devctl2_ioctl+0x56f\n#11 0xffffffff809d10dc at devfs_ioctl+0xcc\n#12 0xffffffff80c3b9b4 at vn_ioctl+0xd4\n#13 0xffffffff809d177e at devfs_ioctl_f+0x1e\n#14 0xffffffff80bb1535 at kern_ioctl+0x255\n#15 0xffffffff80bb1273 at sys_ioctl+0x123\n#16 0xffffffff8100d119 at amd64_syscall+0x109\n#17 0xffffffff80fe413b at fast_syscall_common+0xf8\nUptime: 15s\nDumping 212 out of 470 MB:..8%..16%..23%..31%..46%..53%..61%..76%..83%..91%\n\n__curthread () at /usr/src/sys/amd64/include/pcpu_aux.h:57\n57\t/usr/src/sys/amd64/include/pcpu_aux.h: No such file or directory.\n(kgdb) #0  __curthread () at /usr/src/sys/amd64/include/pcpu_aux.h:57\n#1  doadump (textdump=<optimized out>)\n    at /usr/src/sys/kern/kern_shutdown.c:405\n#2  0xffffffff80b42cc7 in kern_reboot (howto=260)\n    at /usr/src/sys/kern/kern_shutdown.c:526\n#3  0xffffffff80b4319f in vpanic (fmt=0xffffffff81136b3b \"%s\", \n    ap=ap@entry=0xfffffe0053f4b750) at /usr/src/sys/kern/kern_shutdown.c:970\n#4  0xffffffff80b42ff3 in panic (fmt=<unavailable>)\n    at /usr/src/sys/kern/kern_shutdown.c:894\n#5  0xffffffff8100c85c in trap_fatal (frame=0xfffffe0053f4b840, eva=40)\n    at /usr/src/sys/amd64/amd64/trap.c:952\n#6  0xffffffff8100c8af in trap_pfault (frame=0xfffffe0053f4b840, \n    usermode=false, signo=<optimized out>, ucode=<optimized out>)\n    at /usr/src/sys/amd64/amd64/trap.c:760\n#7  <signal handler called>\n#8  0xffffffff80c5e0c8 in if_addgroup (ifp=ifp@entry=0xfffff80007fca000, \n    groupname=0xffffffff811e1f39 \"all\") at /usr/src/sys/net/if.c:1477\n#9  0xffffffff80c5ceb5 in if_attach_internal (\n    ifp=ifp@entry=0xfffff80007fca000, vmove=false)\n    at /usr/src/sys/net/if.c:842\n#10 0xffffffff80c5ce59 in if_attach (ifp=0xfffff80006eb6800, \n    ifp@entry=0xfffff80007fca000) at /usr/src/sys/net/if.c:772\n#11 0xffffffff80c6824c in ether_ifattach (ifp=0xfffff80006eb6800, \n    ifp@entry=0xfffff80007fca000, lla=0xfffff80001027500 \"\", \n    lla@entry=0xfffffe0053f4ba80 \"\") at /usr/src/sys/net/if_ethersubr.c:1001\n#12 0xffffffff80f779c6 in hn_attach (dev=0xfffff8000291ce00)\n    at /usr/src/sys/dev/hyperv/netvsc/if_hn.c:2436\n#13 0xffffffff80b7fa1e in DEVICE_ATTACH (dev=0xfffff8000291ce00)\n    at ./device_if.h:195\n#14 device_attach (dev=dev@entry=0xfffff8000291ce00)\n    at /usr/src/sys/kern/subr_bus.c:2535\n#15 0xffffffff80b84dcf in devctl2_ioctl (cdev=<optimized out>, \n    cmd=2157462531, data=<optimized out>, fflag=<optimized out>, \n    td=0xfffffe0054963c80) at /usr/src/sys/kern/subr_bus.c:5433\n#16 0xffffffff809d10dc in devfs_ioctl (ap=0xfffffe0053f4bc40)\n    at /usr/src/sys/fs/devfs/devfs_vnops.c:933\n#17 0xffffffff80c3b9b4 in vn_ioctl (fp=0xfffff8000704ce10, \n    com=18446735277633467648, data=0xfffff8000779ee00, \n    active_cred=0xfffff8000702cb00, td=0x0)\n    at /usr/src/sys/kern/vfs_vnops.c:1701\n#18 0xffffffff809d177e in devfs_ioctl_f (fp=0xfffff80006eb6800, \n    com=18446735277633467648, data=0x1, cred=0x1, td=0x0)\n    at /usr/src/sys/fs/devfs/devfs_vnops.c:864\n#19 0xffffffff80bb1535 in fo_ioctl (fp=0xfffff8000704ce10, com=2157462531, \n    data=0x1, active_cred=0x1, td=0xfffffe0054963c80)\n    at /usr/src/sys/sys/file.h:366\n#20 kern_ioctl (td=td@entry=0xfffffe0054963c80, fd=<optimized out>, \n    com=com@entry=2157462531, \n    data=0x1 <error: Cannot access memory at address 0x1>, \n    data@entry=0xfffff8000779ee00 \"hn0\")\n    at /usr/src/sys/kern/sys_generic.c:805\n#21 0xffffffff80bb1273 in sys_ioctl (td=0xfffffe0054963c80, \n    uap=0xfffffe0054964080) at /usr/src/sys/kern/sys_generic.c:713\n#22 0xffffffff8100d119 in syscallenter (td=0xfffffe0054963c80)\n    at /usr/src/sys/amd64/amd64/../../kern/subr_syscall.c:187\n#23 amd64_syscall (td=0xfffffe0054963c80, traced=0)\n    at /usr/src/sys/amd64/amd64/trap.c:1197\n#24 <signal handler called>\n#25 0x000032e7074bce0a in ?? ()\nBacktrace stopped: Cannot access memory at address 0x32e7069aff48\n(kgdb)","creation_time":"2023-11-27T17:14:39Z","bug_id":275381,"count":0,"id":1285941,"creator":"zlei@FreeBSD.org","attachment_id":null},{"text":"Other ethernet interface drivers are also affected, tested with re(4) and cxgbe(4).\n\nProposed fix: https://reviews.freebsd.org/D42678","time":"2023-11-27T17:20:15Z","bug_id":275381,"creation_time":"2023-11-27T17:20:15Z","is_private":false,"attachment_id":null,"creator":"zlei@FreeBSD.org","id":1285943,"count":1}]}}}